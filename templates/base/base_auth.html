{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="FoodLoop - Connecting food donors with those in need">
    <meta name="keywords" content="food donation, charity, sustainability">
    
    <title>{% block title %}FoodLoop - Fighting Food Waste, Feeding Communities{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    
    <!-- Tailwind CSS CDN (for development - replace with compiled version in production) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        secondary: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'bounce-subtle': 'bounceSubtle 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="font-sans bg-gray-50 antialiased">
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 flex flex-col items-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-primary-600"></div>
            <p class="mt-4 text-gray-700 font-medium">Loading...</p>
        </div>
    </div>

    <!-- Skip to main content (Accessibility) -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary-600 text-white px-4 py-2 rounded-lg z-50">
        Skip to main content
    </a>

    <!-- Navigation -->
    {% include 'components/navbar.html' %}

    <!-- Main Content Wrapper -->
    <div class="flex min-h-screen">
        
        <!-- Sidebar (if user is authenticated) -->
        {% if user.is_authenticated %}
            {% include 'components/sidebar.html' %}
        {% endif %}

        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 {% if user.is_authenticated %}lg:ml-64{% endif %} transition-all duration-300">
            
            <!-- Page Header -->
            {% block page_header %}{% endblock %}

            <!-- Messages/Alerts -->
            {% if messages %}
                <div class="container mx-auto px-4 py-4 animate-slide-down">
                    {% for message in messages %}
                        <div class="mb-4 p-4 rounded-lg border-l-4 flex items-start justify-between
                            {% if message.tags == 'error' %}bg-red-50 border-red-500 text-red-800
                            {% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-500 text-yellow-800
                            {% elif message.tags == 'success' %}bg-green-50 border-green-500 text-green-800
                            {% elif message.tags == 'info' %}bg-blue-50 border-blue-500 text-blue-800
                            {% else %}bg-gray-50 border-gray-500 text-gray-800{% endif %}
                            shadow-sm animate-fade-in">
                            <div class="flex items-start">
                                <span class="mr-3 text-xl">
                                    {% if message.tags == 'error' %}<i class="fas fa-exclamation-circle"></i>
                                    {% elif message.tags == 'warning' %}<i class="fas fa-exclamation-triangle"></i>
                                    {% elif message.tags == 'success' %}<i class="fas fa-check-circle"></i>
                                    {% elif message.tags == 'info' %}<i class="fas fa-info-circle"></i>
                                    {% else %}<i class="fas fa-bell"></i>{% endif %}
                                </span>
                                <div>
                                    <p class="font-medium">{{ message }}</p>
                                </div>
                            </div>
                            <button onclick="this.parentElement.remove()" class="text-current opacity-50 hover:opacity-100 transition-opacity">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Main Content Block -->
            <div class="container mx-auto px-4 py-6 lg:py-8 animate-fade-in">
                {% block content %}{% endblock %}
            </div>

        </main>
    </div>

    <!-- Footer -->
    {% include 'components/footer.html' %}

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- Back to Top Button -->
    <button id="back-to-top" 
            class="hidden fixed bottom-8 right-8 bg-primary-600 text-white p-4 rounded-full shadow-lg hover:bg-primary-700 transition-all duration-300 hover:scale-110 z-40"
            onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- WebSocket for Real-time Notifications -->
    {% if user.is_authenticated %}
    <script src="{% static 'js/notifications.js' %}"></script>
    {% endif %}
    
    <!-- Custom Scripts -->
    <script src="{% static 'js/scripts.js' %}"></script>

    <!-- Back to Top Button Logic -->
    <script>
        // Show/hide back to top button
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('back-to-top');
            if (window.pageYOffset > 300) {
                backToTop.classList.remove('hidden');
            } else {
                backToTop.classList.add('hidden');
            }
        });

        // Loading overlay helpers
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        // Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.className = `${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 min-w-[300px] animate-slide-up`;
            toast.innerHTML = `
                <i class="fas ${icons[type]} text-xl"></i>
                <span class="flex-1">${message}</span>
                <button onclick="this.parentElement.remove()" class="text-white opacity-75 hover:opacity-100">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar && overlay) {
                sidebar.classList.toggle('-translate-x-full');
                overlay.classList.toggle('hidden');
            }
        }

        // Close mobile menu when clicking overlay
        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.getElementById('sidebar-overlay');
            if (overlay) {
                overlay.addEventListener('click', toggleMobileMenu);
            }
        });

        // CSRF token for AJAX requests
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        // Setup AJAX with CSRF token
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>