{% extends 'base/base.html' %}
{% load static %}

{% block title %}Rate User - FoodLoop{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
        
        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 p-8 text-center text-white">
            <div class="mx-auto w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mb-4 backdrop-blur-sm shadow-inner">
                <i class="fas fa-star text-3xl text-white"></i>
            </div>
            <h1 class="text-3xl font-extrabold mb-2">
                {% if existing_rating %}Update Your Review{% else %}Rate Your Experience{% endif %}
            </h1>
            <p class="text-white/90 text-lg">
                How was your exchange with <span class="font-bold border-b border-white/40">{{ rated_user.get_full_name|default:rated_user.username }}</span>?
            </p>
        </div>

        <div class="px-8 py-4 bg-gray-50 border-b border-gray-100 flex items-center">
            <div class="w-12 h-12 bg-white rounded-lg border border-gray-200 p-1 flex-shrink-0 overflow-hidden">
                {% if donation.image %}
                    <img src="{{ donation.image.url }}" class="w-full h-full object-cover rounded">
                {% else %}
                    <div class="w-full h-full flex items-center justify-center text-gray-400"><i class="fas fa-utensils"></i></div>
                {% endif %}
            </div>
            <div class="ml-4">
                <p class="text-xs text-gray-500 uppercase font-bold tracking-wide">For Donation</p>
                <p class="text-gray-900 font-bold text-lg leading-tight">{{ donation.title }}</p>
            </div>
        </div>

        <div class="p-8">
            <form method="post" class="space-y-8" x-data="{ rating: {{ form.rating.value|default:0 }} }">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl text-sm">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}

                <div class="text-center">
                    <label class="block text-sm font-bold text-gray-700 mb-4 uppercase tracking-wide">Tap stars to rate</label>
                    
                    <div class="flex justify-center gap-3 mb-2">
                        {% for i in "12345" %}
                        <label class="cursor-pointer group relative">
                            <input type="radio" name="rating" value="{{ i }}" class="sr-only" x-model="rating">
                            <i class="fas fa-star text-5xl transition-all duration-200 transform group-hover:scale-110" 
                               :class="rating >= {{ i }} ? 'text-yellow-400 drop-shadow-sm' : 'text-gray-200 group-hover:text-yellow-200'"></i>
                        </label>
                        {% endfor %}
                    </div>
                    
                    <div class="h-6 text-sm font-medium text-yellow-600 transition-opacity duration-300" x-show="rating > 0" x-transition>
                        <span x-text="['', 'Poor', 'Fair', 'Good', 'Very Good', 'Excellent'][rating]"></span>
                    </div>
                    
                    {% if form.rating.errors %}
                        <p class="mt-2 text-sm text-red-600 font-medium">{{ form.rating.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.comment.id_for_label }}" class="block text-sm font-bold text-gray-700 mb-2">
                        Additional Comments <span class="text-gray-400 font-normal">(Optional)</span>
                    </label>
                    <textarea name="comment" id="{{ form.comment.id_for_label }}" rows="4" 
                              class="w-full rounded-xl border-gray-300 focus:border-yellow-500 focus:ring focus:ring-yellow-200 focus:ring-opacity-50 transition-shadow resize-none"
                              placeholder="Share details about punctuality, communication, or food quality...">{{ form.comment.value|default:'' }}</textarea>
                    <p class="mt-2 text-xs text-gray-500">Your feedback helps build trust in the community.</p>
                    {% if form.comment.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.comment.errors.0 }}</p>
                    {% endif %}
                </div>

                <div class="flex gap-4 pt-2">
                    <a href="{% url 'core:donation_detail' donation.id %}" class="flex-1 py-3.5 px-6 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors text-center">
                        Skip
                    </a>
                    <button type="submit" class="flex-1 py-3.5 px-6 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold rounded-xl shadow-lg shadow-orange-500/30 transition-all transform hover:-translate-y-0.5">
                        Submit Review
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}